---
title: "ComBat"
author: "Jonathan Dayton"
date: "7/25/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r include=FALSE}
install_sva <- function() {
  ## try http:// if https:// URLs are not supported
  source("https://bioconductor.org/biocLite.R")
  biocLite("sva")
}
if (!require("sva")) install_sva()
library(sva)
```

```{r}
df = read.csv("../../data/mnist_matrix.csv")
data = as.matrix(df)
```

Remove the features that don't vary, i.e. the ones where max() == min().

```{r}
remove_nonvarying_rows <- function(matrix_)
{
  matrix_ <- matrix_ %>%
    tbl_df() %>%
    mutate_(min = min(names(.)), max = max(names(.))) %>%
    filter(max > min) %>%
    select(-min, -max) %>%
    as.matrix()
  colnames(matrix_) <- NULL
  matrix_
}

fake_matrix <- matrix(c(1, 2, 3, 1, 3, 4, 1, 4, 5, 1, 5, 6), nrow=3, ncol=4)
fake_matrix
fake_matrix %>% remove_nonvarying_rows()
```

```{r}
ComBat(remove_nonvarying_rows(data), c(rep(1, 5000), rep(2, 5000)))
```