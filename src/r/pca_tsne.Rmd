---
title: "PCA & t-SNE"
author: "Jonathan Dayton"
date: "12/31/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
if (!require("pacman")) install.packages("pacman"); library(pacman)
p_load("tidyverse", "Rtsne")
source("functions.R")
```

Load data

```{r}
original <- read_csv("../../data/mnist/unadjusted.csv")
noisy <- read_csv("../../data/mnist/noisy.csv")
combat <- read_csv("../../data/mnist/noisy_combat.csv")
confounded <- read_csv("../../data/output/mnist/mnist.csv")
```

```{r}
vals <- noisy %>% select_if(function (col) !is.whole(col) & is.numeric(col))
pcs <- vals %>% prcomp()
```

PCA

```{r}
continuous_cols <- function(df) {
  df %>% select_if(function (col) !is.whole(col) & is.numeric(col))
}
pca_chart <- function(df) {
  vals <- continuous_cols(df)
  pcs <- vals %>% prcomp()
  tibble(Batch = noisy$Batch, PC1 = pcs$x[, "PC1"], PC2 = pcs$x[, "PC2"]) %>%
    ggplot(aes(x = PC1, y = PC2, color = Batch, alpha=0.2)) +
    geom_point()
}
pca_chart(original)
pca_chart(noisy)
pca_chart(combat)
pca_chart(confounded)
```

t-SNE

```{r}
tsne_chart <- function(df) {
  tsne <- df %>% continuous_cols() %>%
    Rtsne() %>%
    .$Y
  tibble(Batch = noisy$Batch, Dim1 = tsne[, 1], Dim2 = tsne[, 2]) %>%
    ggplot(aes(x = Dim1, y = Dim2, color = Batch, alpha = 0.2)) +
    geom_point()
}
tsne_chart(original)
tsne_chart(noisy)
tsne_chart(combat)
tsne_chart(confounded)

```

